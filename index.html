<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystery Box 2025 - Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#070607;--card:#151515;--panel:#1c1c1c;--accent:linear-gradient(90deg,#ffdd55,#f2b705);--gold:#f0c84b;--muted:#bdbdbd;--glass: rgba(255,255,255,0.03);}
*{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:"Poppins",Arial,Helvetica,sans-serif;-webkit-font-smoothing:antialiased} a{color:inherit}
.wrap{max-width:1300px;margin:28px auto;padding:28px;display:flex;flex-direction:column;align-items:center;gap:84px} header{width:100%;display:flex;flex-direction:column;align-items:center;gap:18px}
h1{margin:0;font-family:"Playfair Display","Poppins",serif;font-weight:700;font-size:72px;line-height:0.95;letter-spacing:2px;color:var(--gold);text-shadow:0 6px 24px rgba(240,200,75,0.08), 0 2px 8px rgba(0,0,0,0.6);transform:translateZ(0);}
.instructions{width:100%;max-width:980px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:34px;border:1px solid rgba(240,200,75,0.06);box-shadow:0 10px 40px rgba(0,0,0,0.6);font-size:20px;line-height:1.6;color: #e9e6e0;text-align:center;letter-spacing:0.3px;}
.main-boxes{width:100%;display:flex;flex-wrap:wrap;gap:56px;justify-content:center;align-items:center}
.box-container{position:relative;width:190px;height:190px;display:flex;align-items:center;justify-content:center;transition:transform .28s cubic-bezier(.2,.9,.2,1), box-shadow .28s;}
.box-container:hover{transform:translateY(-6px) scale(1.02);}
.main-box{width:100%;height:100%;border-radius:16px;border:3px solid rgba(240,200,75,0.95);background: linear-gradient(145deg,#2a2a2a,#151515);display:flex;align-items:center;justify-content:center;box-shadow: 0 25px 60px rgba(0,0,0,0.6), 0 4px 20px rgba(240,200,75,0.06) inset;color:var(--gold);font-weight:700;font-family:"Poppins",sans-serif;font-size:26px;letter-spacing:1px;text-transform:uppercase;}
.mini-box, .mini-minibox{width:56px;height:56px;border-radius:10px;background: linear-gradient(180deg,#2b2b2b,#111);border:2px solid rgba(255,255,255,0.06);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;cursor:pointer;position:absolute;transition:transform .18s ease, box-shadow .18s ease, background .18s ease;box-shadow: 0 6px 22px rgba(0,0,0,0.65);}
.mini-box:hover, .mini-minibox:hover{transform:scale(1.2) translateY(-4px);background:linear-gradient(90deg,#fff4c7,#f1c84a);color:#111;box-shadow: 0 18px 40px rgba(241,200,80,0.18);}
.modal{display:none;position:fixed;inset:0;z-index:9999;background:linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.82));backdrop-filter: blur(6px);align-items:center;justify-content:center;padding:28px}
.modal.show{display:flex}
.viewer{width:100%;max-width:1180px;height:84vh;background:linear-gradient(180deg,var(--panel), #111);border-radius:16px;border:2px solid rgba(240,200,75,0.08);overflow:hidden;position:relative;box-shadow:0 30px 120px rgba(0,0,0,0.7);display:flex;flex-direction:column;}
.viewer-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;gap:12px;background:linear-gradient(90deg,#0f0f0f, #141414);border-bottom:1px solid rgba(255,255,255,0.02);}
.viewer-title{font-family:"Playfair Display","Poppins",serif;font-size:20px;letter-spacing:0.8px;color:var(--gold);font-weight:700;}
.viewer-controls{display:flex;gap:10px;align-items:center}
.open-new{background:var(--glass);padding:8px 12px;border-radius:10px;color:var(--gold);text-decoration:none;font-weight:600;border:1px solid rgba(255,255,255,0.03)}
.close-btn{cursor:pointer;font-size:22px;color:var(--gold);padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);background:transparent}
.viewer-body{flex:1;display:flex;align-items:center;justify-content:center;padding:12px}
.viewer-body iframe{width:100%;height:100%;border:0;background:#000}
.viewer-body img{max-width:100%;max-height:100%;object-fit:contain;border-radius:6px}
.viewer-footer{padding:12px 18px;color:var(--muted);font-size:14px;border-top:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
@media (max-width:980px){h1{font-size:48px}.wrap{gap:40px;padding:18px}.main-box{font-size:20px}.mini-box,.mini-minibox{width:48px;height:48px;font-size:16px}.viewer{height:86vh}}
@media (max-width:640px){h1{font-size:36px}.box-container{width:140px;height:140px}.mini-box,.mini-minibox{width:44px;height:44px;font-size:14px}}
.box-appear{animation:boxPop .6s cubic-bezier(.2,.9,.2,1) both}
@keyframes boxPop{from{opacity:0;transform:translateY(12px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}
</style>
</head>
<body>
<div class="wrap">
<header>
<h1>Mystery Box 2025</h1>
<div class="instructions" id="mainInstructions">
Use a device in dark mode with 100% brightness. Be in a completely dark or very dim room. Any other setting will ruin the experience.
</div>
</header>
<div class="main-boxes" id="mainBoxes"></div>
</div>
<div id="modal" class="modal" aria-hidden="true">
<div class="viewer" role="dialog" aria-modal="true">
<div class="viewer-header">
<div class="viewer-title" id="viewerTitle">Contenido</div>
<div class="viewer-controls">
<a id="viewerOpenNew" class="open-new" href="#" target="_blank" rel="noopener" style="display:none">Abrir en nueva pestaña</a>
<button id="closeBtn" class="close-btn" title="Cerrar">✕</button>
</div>
</div>
<div class="viewer-body" id="viewerBody"></div>
<div class="viewer-footer" id="viewerFooter"></div>
</div>
</div>
<script>
function toDrivePreview(url){try{if(!url||typeof url!=='string')return url;const m=url.match(/\/d\/([a-zA-Z0-9_-]{10,})/);if(m&&m[1])return `https://drive.google.com/file/d/${m[1]}/preview`;if(url.includes('/preview'))return url;if(url.includes('uc?export=view')||url.includes('drive.googleusercontent.com'))return url;return url}catch(e){return url;}}

const boxesData={
1:{miniBoxes:[[
"https://drive.google.com/file/d/1ed0FlblrQm7h9y3WGXa3CrGJshBRtlMC/view?usp=drivesdk",
"https://drive.google.com/file/d/1U0Q4FHLY-Vecb5xXLyEquBR2ED-E3l2K/view?usp=drivesdk",
"https://drive.google.com/file/d/1Mwhmu5XRz0G8s7kfKbPFZB-uRgoIXic5/view?usp=drivesdk",
"https://drive.google.com/file/d/1XKEHCqaitGZKDbHv0pX8opIzuYF8X2Kl/view?usp=drivesdk",
"https://drive.google.com/file/d/1lXjoVzh8PuWBt-EHEfrqUclsCLefxICv/view?usp=drivesdk",
"https://drive.google.com/file/d/1P8p1jx1CdjkkBj0fWFNEWy8wQKT0osMM/view?usp=drivesdk",
"https://drive.google.com/file/d/1RlGbocTeD6u2NEhJtKDL5N_mVhXpB5Ji/view?usp=drivesdk",
"https://drive.google.com/file/d/1QiJ94N0LY1Qaqk6DA-uUHurw0orH0tFY/view?usp=drivesdk",
"https://drive.google.com/file/d/1Z3LdQ3E-v-ivALkQPzBVex6R-gFzCRq2/view?usp=drivesdk"
]], randomSingle:true},
2:{miniBoxes:[[
"https://drive.google.com/file/d/179oAz9qxQopvfxQsgTG8EQAarO0A4w5o/view?usp=drivesdk",
"https://drive.google.com/file/d/175ONUuwSZNAaOzb4QxJz2mg19Z4FHy0q/view?usp=drivesdk"
]], randomSingle:true},
3:{miniBoxes:[[
"https://drive.google.com/file/d/1rB6lR8oz4dyWW5si_m_tneEtrVMt3Nix/view?usp=drivesdk",
"https://drive.google.com/file/d/1KugxWOlnQsJkhnikeS4p3r8uyHnBphBo/view?usp=drivesdk"
]], randomSingle:true},
4:{miniBoxes:[[
"https://drive.google.com/file/d/1nCtMuv2GIENvjNRx_faSAgwkLH4i5DmX/view?usp=drivesdk",
"https://drive.google.com/file/d/13cglOJ-vRwIPIAyQGIBCUjShHwi2DTv6/view?usp=drivesdk"
]], randomSingle:true},
5:{miniBoxes:["https://luisfernando2025xt.github.io/xmas-mystery-box/"], codes:["ABC123","XYZ789","LMN456","PL55MN88","QW11ER22","GH12JK34","RT56UV78","YZ90AB12","CD34EF56","MN78OP90"], codeSingleRandom:true},
6:{miniBoxes:["https://luisfernando2025xt.github.io/xmas_game/","https://luisfernando2025xt.github.io/xmas_game_2/"]}
};

for(const k in boxesData){
  const box=boxesData[k];
  if(Array.isArray(box.miniBoxes)){
    box.miniBoxes=box.miniBoxes.map(mb=>{
      if(Array.isArray(mb))return mb.map(toDrivePreview);
      if(typeof mb==='string')return toDrivePreview(mb);
      return mb;
    });
  }
}

const mainBoxesEl=document.getElementById('mainBoxes');
const modal=document.getElementById('modal');
const viewerBody=document.getElementById('viewerBody');
const viewerTitle=document.getElementById('viewerTitle');
const viewerFooter=document.getElementById('viewerFooter');
const viewerOpenNew=document.getElementById('viewerOpenNew');
const closeBtn=document.getElementById('closeBtn');

function persistKey(box,mini,key){return `mystery_box_${box}_mini_${mini}_${key}`;}

function createBoxes(){
  for(let n=1;n<=6;n++){
    const cont=document.createElement('div');cont.className='box-container box-appear';cont.dataset.box=n;
    const main=document.createElement('div');main.className='main-box';main.textContent=`Box ${n}`;cont.appendChild(main);mainBoxesEl.appendChild(cont);
    const boxData=boxesData[n];let miniBoxes=[];
    if(boxData && Array.isArray(boxData.miniBoxes)) miniBoxes=boxData.miniBoxes;
    const radius=96;const angleStep=miniBoxes.length>1?(2*Math.PI)/miniBoxes.length:0;
    miniBoxes.forEach((mb,i)=>{
      const mini=document.createElement('div');mini.className='mini-box';mini.textContent=i+1;
      const angle=i*angleStep-Math.PI/2;mini.style.left=`${Math.round(radius*Math.cos(angle)+70)}px`;mini.style.top=`${Math.round(radius*Math.sin(angle)+70)}px`;
      cont.appendChild(mini);
      if(Array.isArray(mb)){
        let selectedIndex=null;
        if(boxData && boxData.randomSingle){
          const storageKey=persistKey(n,i,'selectedIndex');const stored=localStorage.getItem(storageKey);
          if(stored!==null)selectedIndex=parseInt(stored,10); else {selectedIndex=Math.floor(Math.random()*mb.length);localStorage.setItem(storageKey,String(selectedIndex));}
          mini.dataset.selectedIndex=selectedIndex;
        }
        const createIndices=(boxData && boxData.randomSingle)?[selectedIndex]:[...Array(mb.length).keys()];
        const nestedRadius=60;const nestedAngleStep=createIndices.length>1?(2*Math.PI)/createIndices.length:0;
        createIndices.forEach((idx,j)=>{
          const mm=document.createElement('div');mm.className='mini-minibox';mm.textContent=(idx+1);
          const nangle=j*nestedAngleStep-Math.PI/2;
          mm.style.left=`${Math.round(parseInt(mini.style.left)+nestedRadius*Math.cos(nangle))}px`;
          mm.style.top=`${Math.round(parseInt(mini.style.top)+nestedRadius*Math.sin(nangle))}px`;
          mm.dataset.url=Array.isArray(mb)?mb[idx]:'';mm.dataset.box=n;mm.dataset.miniIndex=i;mm.dataset.miniMiniIndex=idx;
          mm.addEventListener('click',onMiniMiniClick);cont.appendChild(mm);
        });
      } else if(typeof mb==='string'){
        mini.dataset.url=mb;mini.dataset.box=n;mini.dataset.miniIndex=i;
        mini.addEventListener('click',(e)=>{
          e.stopPropagation();const bdata=boxesData[n];
          if(bdata && bdata.codeSingleRandom && bdata.codes){
            const storageKey=persistKey(n,i,'chosenCode');let chosen=localStorage.getItem(storageKey);
            if(!chosen){const cidx=Math.floor(Math.random()*bdata.codes.length);chosen=bdata.codes[cidx];localStorage.setItem(storageKey,chosen);}
            openViewer({title:`Box ${n} - Código de acceso`,url:mini.dataset.url,code:chosen,box:n});
          } else {openViewer({title:`Box ${n}`,url:mini.dataset.url,box:n});}
        });
      }
      main.addEventListener('click',()=>{openInstructions(n);});
    });
  }
}

function onMiniMiniClick(e){e.stopPropagation();const t=e.currentTarget;let url=t.dataset.url;const box=t.dataset.box;const miniIndex=t.dataset.miniIndex;const miniMiniIndex=t.dataset.miniMiniIndex;
  const parent=boxesData[box];if(parent && parent.randomSingle && (!url||url==='undefined')){const mb=parent.miniBoxes[miniIndex];const storageKey=persistKey(box,miniIndex,'selectedIndex');let sel=localStorage.getItem(storageKey);if(sel===null){sel=Math.floor(Math.random()*mb.length);localStorage.setItem(storageKey,String(sel));}url=mb[parseInt(sel,10)];t.dataset.url=url;}
  openViewer({title:`Mystery Box ${box} - Mini ${parseInt(miniIndex)+1} - Item ${parseInt(miniMiniIndex)+1}`,url:url,box:box});
}

function openViewer({title='Contenido',url,code=null,box=null}){
  viewerTitle.textContent=title;viewerFooter.textContent=code?`Código revelado: ${code}`:`Box ${box||''}`;viewerOpenNew.style.display='none';viewerOpenNew.href='#';viewerBody.innerHTML='';
  if(!url){viewerBody.innerHTML=`<div style="padding:28px;color:var(--muted);text-align:center">Contenido no disponible</div>`;modal.classList.add('show');modal.setAttribute('aria-hidden','false');return;}
  const isDrive=url.includes('drive.google.com/file/d/');const imageExt=url.match(/\.(png|jpg|jpeg|gif|webp)(\?|$)/i);const pdfExt=url.match(/\.pdf(\?|$)/i);
  if(isDrive || pdfExt || !imageExt){const iframe=document.createElement('iframe');iframe.src=url;iframe.allow='autoplay; encrypted-media; fullscreen';iframe.loading='lazy';iframe.style.background='#000';viewerBody.appendChild(iframe);viewerOpenNew.style.display='inline-block';viewerOpenNew.href=url;}
  else if(imageExt){const img=document.createElement('img');img.src=url;img.alt=title;viewerBody.appendChild(img);viewerOpenNew.style.display='inline-block';viewerOpenNew.href=url;}
  else{const iframe=document.createElement('iframe');iframe.src=url;iframe.loading='lazy';viewerBody.appendChild(iframe);viewerOpenNew.style.display='inline-block';viewerOpenNew.href=url;}
  modal.classList.add('show');modal.setAttribute('aria-hidden','false');
}

closeBtn.addEventListener('click',()=>{modal.classList.remove('show');viewerBody.innerHTML='';modal.setAttribute('aria-hidden','true');});
modal.addEventListener('click',(ev)=>{if(ev.target===modal){modal.classList.remove('show');viewerBody.innerHTML='';modal.setAttribute('aria-hidden','true');}});

function openInstructions(boxNumber){const txt=`Instructions for Mystery Box ${boxNumber}: To unlock the full effect of this box, make sure you’re in a completely dark room — the content only reveals itself when the lights are gone.`;viewerTitle.textContent=`Box ${boxNumber} — Instrucciones`;viewerFooter.textContent='';viewerOpenNew.style.display='none';viewerBody.innerHTML=`<div style="padding:28px;color:var(--muted);line-height:1.6">${txt}</div>`;modal.classList.add('show');modal.setAttribute('aria-hidden','false');}

createBoxes();
</script>
</body>
</html>
